<script>
    const TUNNEL_URL = 'https://jkg.ngrok.app'; 
    
    // Meldung 1: Wenn das MACBOOK AUS ist (ERR_NGROK_3200)
    const OFFLINE_MESSAGE_HTML = `
        <div class="offline">
            <h1>üõë Gesamtsystem offline!</h1>
            <p>Das MacBook ist momentan ausgeschaltet (ERR_NGROK_3200).</p>
            <p>Schreibe mir eine WhatsApp ‚Äì ich schalte den Server dann schnellstm√∂glich f√ºr dich an.</p>
        </div>
    `;

    // Meldung 2: Wenn der WEBSERVER AUS ist (Docker gestoppt)
    const SERVER_DOWN_MESSAGE_HTML = `
        <div class="offline">
            <h1>üö® Webserver gestoppt!</h1>
            <p>Der ngrok-Tunnel ist aktiv, aber der **Docker-Webserver (Open WebUI)** ist nicht gestartet (Fehler 502/500).</p>
            <p>Bitte eine WhatsApp ‚Äì ich starte den Docker-Container umgehend neu.</p>
        </div>
    `;

    async function checkStatusAndRedirect() {
        try {
            const response = await fetch(TUNNEL_URL, {
                method: 'HEAD', 
                cache: 'no-store'
            });

            // --- STUFE 2: WEBSERVER-CHECK ---
            // Pr√ºft, ob ngrok l√§uft, aber einen internen Fehler (500) oder Bad Gateway (502) meldet.
            if (response.status === 500 || response.status === 502) {
                // Tunnel l√§uft, aber Docker ist gestoppt
                displayMessage(SERVER_DOWN_MESSAGE_HTML);
                return;
            }
            
            // --- WEITERLEITUNG (ALLES OK) ---
            // Pr√ºft, ob der Webserver erreichbar ist (200 OK)
            if (response.ok) { 
                // Webserver und Tunnel sind aktiv
                window.location.replace(TUNNEL_URL);
                return;
            }

            // Fallback f√ºr andere Fehlercodes, bei denen der Tunnel aktiv ist, aber der Webserver nicht
            displayMessage(SERVER_DOWN_MESSAGE_HTML);

        } catch (error) {
            // --- STUFE 1: TUNNEL-CHECK ---
            // Wenn der Fetch-Aufruf fehlschl√§gt, ist der gesamte Tunnel (MacBook) offline.
            displayMessage(OFFLINE_MESSAGE_HTML);
        }
    }

    function displayMessage(htmlContent) {
        document.getElementById('status-message').innerHTML = htmlContent;
    }

    // Startet den Check nach 500ms
    setTimeout(checkStatusAndRedirect, 500);
</script>
